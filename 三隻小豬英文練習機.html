<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<title>ä¸‰éš»å°è±¬è‹±æ–‡ç·´ç¿’æ©Ÿ</title>

<style>
body{
    font-family:"Microsoft JhengHei",sans-serif;
    background:#F5F3F1;
    padding:40px;
    display:flex;
    justify-content:center;
}
.container{ max-width:820px; width:90%; }

/* æ¨™é¡Œ */
h1{
    text-align:center;
    font-size:32px;
    color:#5B5753;
    margin-bottom:4px;
}

/* å‰¯æ¨™ï¼ˆç‰ˆæœ¬ï¼‰ */
#versionLabel{
    text-align:center;
    font-size:10px;
    color:#7E7973;
    margin-bottom:20px;
}

/* Level é¸å–® */
#levelSelect{
    display:block;
    margin:0 auto 22px auto;
    font-size:18px;
    padding:8px 14px;
    border-radius:10px;
    border:1px solid #AAA;
    background:#EFEDEB;
    color:#4A4948;
}

/* Tabs */
.tabs{
    display:flex; gap:10px; margin-bottom:20px;
}
.tabs button{
    flex:1; padding:10px; font-size:18px;
    border:none; border-radius:12px;
    background:#D4CBC3; color:#555; cursor:pointer;
    transition:0.2s;
}
.tabs button:hover{ filter:brightness(0.93); }
.tabs button.active{
    background:#C8BEB6; font-weight:bold;
}

/* å–®å­— */
.word{
    font-size:48px; font-weight:bold;
    margin-bottom:10px;
    color:#4A4948;
}

/* éŸ³ç¯€ */
.syllable{ 
    margin-left:20px; 
    margin-bottom:10px; 
    font-size:22px; 
}
.syll-gray{ color:#9B9B9B; }
.syll-vowel{ color:#C27C88; font-weight:bold; }

/* ä¸­æ–‡ã€ä¾‹å¥ */
.mean{ margin-left:20px; font-size:16px; margin-bottom:8px; color:#4A4948; }
.example{ margin-left:20px; font-size:18px; margin-bottom:20px; color:#4A4948; }
.example-word{ color:#C27C88; font-weight:bold; }

/* Buttons */
button.action,button.next{
    padding:10px 18px;
    margin:6px 6px 6px 0;
    border:none;
    border-radius:10px;
    cursor:pointer;
    color:white;
    font-size:18px;
    transition:0.2s;
}
button.action{ background:#B8AFA5; }
button.action:hover{ background:#A79F96; }

button.next{ background:#988F88; }
button.next:hover{ background:#8B827C; }

/* è½å¯« */
#dictInput{
    width:100%; font-size:22px;
    padding:10px; border-radius:10px;
    border:1px solid #AAA;
    margin-top:10px;
    background:#FAF9F8;
}

#done{ 
    font-size:32px; text-align:center; 
    color:#6A5F58; display:none; margin-top:20px; 
}

#restartBtn{
    display:none; padding:12px 18px; margin:20px auto;
    border:none; border-radius:10px;
    background:#8A7F76; color:white; cursor:pointer; font-size:20px;
}
#restartBtn:hover{ background:#7A7068; }

#summaryBlock,#wrongBlock{
    display:none; background:#ECE9E6;
    padding:12px; border-radius:10px;
    margin-top:10px; font-size:16px; line-height:1.6;
}
.correct{ color:#3FA63F; font-weight:bold; }
.wrong{ color:#D9534F; font-weight:bold; }
</style>
</head>

<body>
<div class="container">

<h1>ä¸‰éš»å°è±¬è‹±æ–‡ç·´ç¿’æ©Ÿ</h1>
<div id="versionLabel"></div>

<!-- Level é¸æ“‡ -->
<select id="levelSelect">
    <option value="MJ7">MJ7</option>
    <option value="MJ8">MJ8</option>
    <option value="MJ9">MJ9</option>
</select>

<!-- Tabs -->
<div class="tabs">
  <button id="tCard" class="active">å–®å­—å¡</button>
  <button id="tDict">è½å¯«</button>
</div>

<!-- å–®å­—å¡ -->
<div id="cardSec">
  <div id="cWord" class="word"></div>
  <div id="cSyl" class="syllable"></div>
  <div id="cMean" class="mean"></div>
  <div id="cEx" class="example"></div>

  <button class="action" onclick="speakWord()">é»æˆ‘è½å–®å­—</button>
  <button class="action" onclick="speakEx()">é»æˆ‘è½ä¾‹å¥</button>
  <button class="next" onclick="nextCard()">ä¸‹ä¸€å€‹å–®å­—</button>
</div>

<!-- è½å¯« -->
<div id="dictSec" style="display:none;">
  <div id="dictTitle" style="font-size:18px;margin-bottom:10px;">
    è½ä¸€è½ï¼Œæ‹¼å‡ºå–®å­—ï¼ŒæŒ‰ä¸‹ enter é€²å…¥ä¸‹ä¸€é¡Œ
  </div>

  <button class="action" id="listenBtn" onclick="speakDict()">å†è½ä¸€æ¬¡</button>
  <div id="hint" style="margin:8px 0;color:#555;"></div>
  <input id="dictInput" placeholder="è«‹è¼¸å…¥è‹±æ–‡">

  <div id="done">ğŸ‰ æ­å–œå®Œæˆæœ¬æ¬¡è½å¯«ï¼</div>
  <div id="summaryBlock"></div>
  <div id="wrongBlock"></div>

  <button id="restartBtn" onclick="restartDict()">å†åšä¸€æ¬¡</button>
</div>

<!-- ====================== å­—åº«ï¼ˆæ•´åˆ 40 å­— MJ7ï¼‰ ====================== -->
<script id="wordData" type="application/json">
{
  "MJ7":[
    {"word":"farm","syll":["farm"],"zh":"è¾²å ´","example":"We visited a <span class='example-word'>farm</span> last weekend."},
    {"word":"city","syll":["cit","y"],"zh":"åŸå¸‚","example":"I live in a busy <span class='example-word'>city</span>."},
    {"word":"country","syll":["coun","try"],"zh":"é„‰é–“","example":"My grandparents live in the <span class='example-word'>country</span>."},
    {"word":"yard","syll":["yard"],"zh":"é™¢å­","example":"We played soccer in the <span class='example-word'>yard</span>."},
    {"word":"hotel","syll":["ho","tel"],"zh":"é£¯åº—","example":"We stayed at a nice <span class='example-word'>hotel</span> during our trip."},
    {"word":"popcorn","syll":["pop","corn"],"zh":"çˆ†ç±³èŠ±","example":"I like to eat <span class='example-word'>popcorn</span> at the movies."},
    {"word":"bakery","syll":["bak","er","y"],"zh":"éºµåŒ…åº—","example":"The <span class='example-word'>bakery</span> sells warm bread."},
    {"word":"vest","syll":["vest"],"zh":"èƒŒå¿ƒ","example":"He is wearing a blue <span class='example-word'>vest</span>."},
    {"word":"taxi","syll":["tax","i"],"zh":"è¨ˆç¨‹è»Š","example":"We took a <span class='example-word'>taxi</span> to the station."},
    {"word":"sweater","syll":["sweat","er"],"zh":"æ¯›è¡£","example":"My new <span class='example-word'>sweater</span> is very soft."},

    {"word":"ring","syll":["ring"],"zh":"æˆ’æŒ‡","example":"She wore a shiny <span class='example-word'>ring</span> today."},
    {"word":"forest","syll":["for","est"],"zh":"æ£®æ—","example":"We walked through the quiet <span class='example-word'>forest</span>."},
    {"word":"motorcycle","syll":["mo","tor","cy","cle"],"zh":"æ©Ÿè»Š","example":"He rode his <span class='example-word'>motorcycle</span> to school."},
    {"word":"castle","syll":["cas","tle"],"zh":"åŸå ¡","example":"The <span class='example-word'>castle</span> looks beautiful."},
    {"word":"classroom","syll":["class","room"],"zh":"æ•™å®¤","example":"Our <span class='example-word'>classroom</span> is very bright."},
    {"word":"rose","syll":["rose"],"zh":"ç«ç‘°","example":"She picked a red <span class='example-word'>rose</span>."},
    {"word":"ship","syll":["ship"],"zh":"èˆ¹","example":"The <span class='example-word'>ship</span> sailed across the sea."},
    {"word":"island","syll":["is","land"],"zh":"å³¶å¶¼","example":"We visited a small <span class='example-word'>island</span>."},
    {"word":"surprised","syll":["sur","prised"],"zh":"é©šè¨","example":"He was <span class='example-word'>surprised</span> by the gift."},
    {"word":"gold","syll":["gold"],"zh":"é‡‘å­","example":"The ring is made of <span class='example-word'>gold</span>."},

    {"word":"river","syll":["riv","er"],"zh":"æ²³æµ","example":"We walked along the <span class='example-word'>river</span>."},
    {"word":"present","syll":["pre","sent"],"zh":"ç¦®ç‰©","example":"She opened her birthday <span class='example-word'>present</span>."},
    {"word":"wallet","syll":["wal","let"],"zh":"éŒ¢åŒ…","example":"He lost his <span class='example-word'>wallet</span>."},
    {"word":"bookstore","syll":["book","store"],"zh":"æ›¸åº—","example":"We went to the <span class='example-word'>bookstore</span>."},
    {"word":"spicy","syll":["spi","cy"],"zh":"è¾£çš„","example":"This soup is very <span class='example-word'>spicy</span>."},
    {"word":"envelope","syll":["en","ve","lope"],"zh":"ä¿¡å°","example":"Put the letter in the <span class='example-word'>envelope</span>."},
    {"word":"police station","syll":["po","lice","sta","tion"],"zh":"è­¦å¯Ÿå±€","example":"We saw the <span class='example-word'>police station</span> downtown."},
    {"word":"night market","syll":["night","mar","ket"],"zh":"å¤œå¸‚","example":"We ate dinner at the <span class='example-word'>night market</span>."},
    {"word":"gas station","syll":["gas","sta","tion"],"zh":"åŠ æ²¹ç«™","example":"Dad stopped at a <span class='example-word'>gas station</span>."},
    {"word":"airplane","syll":["air","plane"],"zh":"é£›æ©Ÿ","example":"The <span class='example-word'>airplane</span> is taking off."},

    {"word":"bottle","syll":["bot","tle"],"zh":"ç“¶å­","example":"She drank from a water <span class='example-word'>bottle</span>."},
    {"word":"angry","syll":["an","gry"],"zh":"ç”Ÿæ°£","example":"He was <span class='example-word'>angry</span> after the game."},
    {"word":"glass","syll":["glass"],"zh":"ç»ç’ƒæ¯","example":"The <span class='example-word'>glass</span> fell and broke."},
    {"word":"tomato","syll":["to","ma","to"],"zh":"ç•ªèŒ„","example":"I ate a fresh <span class='example-word'>tomato</span>."},
    {"word":"worried","syll":["wor","ried"],"zh":"æ“”å¿ƒ","example":"She felt <span class='example-word'>worried</span> about the test."},
    {"word":"wonderful","syll":["won","der","ful"],"zh":"ç¾å¥½çš„","example":"We had a <span class='example-word'>wonderful</span> day."},
    {"word":"potato","syll":["po","ta","to"],"zh":"é¦¬éˆ´è–¯","example":"He cooked a <span class='example-word'>potato</span>."},
    {"word":"letter","syll":["let","ter"],"zh":"ä¿¡ä»¶","example":"I wrote a <span class='example-word'>letter</span> to my friend."},
    {"word":"hospital","syll":["hos","pi","tal"],"zh":"é†«é™¢","example":"She works at the <span class='example-word'>hospital</span>."},
    {"word":"restaurant","syll":["res","tau","rant"],"zh":"é¤å»³","example":"We had lunch at a <span class='example-word'>restaurant</span>."}
  ],
  "MJ8":[],
  "MJ9":[]
}
</script>

<!-- ====================== ä¸»ç¨‹å¼ JS ====================== -->
<script>
/* ç‰ˆæœ¬ */
(function(){
    const now = new Date();
    const y = now.getFullYear();
    const m = String(now.getMonth()+1).padStart(2,"0");
    const d = String(now.getDate()).padStart(2,"0");
    window.versionCode = `${y}${m}${d}01`;
    versionLabel.textContent = "ç‰ˆæœ¬ï¼š" + window.versionCode;
})();

/* å­—åº« */
let allLevels = JSON.parse(document.getElementById("wordData").textContent);
let currentLevel = "MJ7";
let wordList = allLevels[currentLevel];

/* ================== â˜… Google US English èªéŸ³ â˜… ================== */
let femaleVoice = null;

function loadVoices() {
    const vs = speechSynthesis.getVoices();

    // ğŸ”¥ 1. å„ªå…ˆ Google US English
    femaleVoice = vs.find(v =>
        v.name.toLowerCase().includes("google") &&
        v.lang === "en-US"
    );

    // ğŸ”¥ 2. æ‰¾å…¶ä»– Google è‹±æ–‡
    if(!femaleVoice){
        femaleVoice = vs.find(v =>
            v.name.toLowerCase().includes("google") &&
            v.lang.startsWith("en")
        );
    }

    // ğŸ”¥ 3. æ‰¾ä»»ä½•ç¾åœ‹è…”
    if(!femaleVoice){
        femaleVoice = vs.find(v => v.lang === "en-US");
    }

    // ğŸ”¥ 4. æœ€å¾Œæ‰æ‰¾è‹±æ–‡
    if(!femaleVoice){
        femaleVoice = vs.find(v => v.lang.startsWith("en"));
    }
}

speechSynthesis.onvoiceschanged = loadVoices;
loadVoices();

/* å·¥å…· */
function shuffle(arr){
    for(let i=arr.length-1;i>0;i--){
        const j=Math.floor(Math.random()*(i+1));
        [arr[i],arr[j]]=[arr[j],arr[i]];
    }
}

function renderSyll(sArr){
    const vowels="aeiou";
    return sArr.map(s=>{
        let out="";
        for(let ch of s){
            if(vowels.includes(ch)){
                out+=`<span class="syll-vowel">${ch}</span>`;
            }else{
                out+=`<span class="syll-gray">${ch}</span>`;
            }
        }
        return out;
    }).join(" ");
}

function colorize(w){
    const vowels="aeiou";
    return w.split("").map(ch=>{
        return vowels.includes(ch)
        ? `<span style="color:#C27C88">${ch}</span>`
        : `<span style="color:#4A708B">${ch}</span>`;
    }).join("");
}

/* å–®å­—å¡ */
let cardOrder=[];
let ci=0;

function loadCard(){
    const o=cardOrder[ci];
    cWord.innerHTML = colorize(o.word);
    cSyl.innerHTML = renderSyll(o.syll);
    cMean.innerHTML = "ä¸­æ–‡ï¼š" + o.zh;
    cEx.innerHTML = o.example;
}

function speakWord(){
    const u = new SpeechSynthesisUtterance(cardOrder[ci].word);
    u.voice=femaleVoice; u.lang="en-US"; u.rate=0.75;
    speechSynthesis.cancel(); speechSynthesis.speak(u);
}

function speakEx(){
    const u = new SpeechSynthesisUtterance(cEx.innerText);
    u.voice=femaleVoice; u.lang="en-US"; u.rate=0.75;
    speechSynthesis.cancel(); speechSynthesis.speak(u);
}

function nextCard(){
    ci++;
    if(ci>=cardOrder.length){
        shuffle(cardOrder);
        ci=0;
    }
    loadCard();
    speakWord();
}

/* è½å¯« */
let dictOrder=[], di=0, playCount=0;
let answers=[];

function initDict(){
    dictOrder=[...wordList];
    shuffle(dictOrder);
    di=0; playCount=0; answers=[];

    dictTitle.style.display="block";
    listenBtn.style.display="inline-block";
    dictInput.style.display="block";
    hint.style.display="block";
    done.style.display="none";
    restartBtn.style.display="none";
    summaryBlock.style.display="none";
    wrongBlock.style.display="none";

    dictInput.value="";
    hint.innerHTML="";
}

function speakDict(){
    const u=new SpeechSynthesisUtterance(dictOrder[di].word);
    u.voice=femaleVoice; u.lang="en-US"; u.rate=0.75;
    speechSynthesis.cancel(); speechSynthesis.speak(u);

    playCount++;
    if(playCount>=3){
        hint.innerHTML="æç¤ºï¼š" + dictOrder[di].zh;
    }
}

dictInput.addEventListener("keydown",e=>{
    if(e.key==="Enter") nextDict();
});

function nextDict(){
    const user=dictInput.value.trim();
    const correct=dictOrder[di].word;

    answers.push({ user, correct });

    di++;
    if(di>=dictOrder.length){
        finishDict();
        return;
    }

    playCount=0;
    hint.innerHTML="";
    dictInput.value="";
    speakDict();
}

function finishDict(){
    dictInput.style.display="none";
    listenBtn.style.display="none";
    hint.style.display="none";
    dictTitle.style.display="none";

    done.style.display="block";
    restartBtn.style.display="block";

    const total = answers.length;
    const correctN = answers.filter(a=>a.user.toLowerCase()===a.correct.toLowerCase()).length;
    const wrongN = total - correctN;

    summaryBlock.innerHTML =
       `å…±ç­” ${total} é¡Œã€€`+
       `ç­”å°ï¼š<span class='correct'>${correctN}</span> é¡Œã€€`+
       `ç­”éŒ¯ï¼š<span class='wrong'>${wrongN}</span> é¡Œ`;
    summaryBlock.style.display="block";

    const wrongs = answers.filter(a=>a.user.toLowerCase()!==a.correct.toLowerCase());
    if(wrongs.length>0){
        wrongBlock.innerHTML = wrongs.map(w=>
            `<div><span class='wrong'>${w.user||"(ç©ºç™½)"}</span> âœ æ­£ç¢ºï¼š${w.correct}</div>`
        ).join("");
        wrongBlock.style.display="block";
    }
}

function restartDict(){
    initDict();
    speakDict();
}

/* Level */
levelSelect.onchange=function(){
    currentLevel=this.value;
    wordList = allLevels[currentLevel];

    if(!wordList || wordList.length===0){
        alert("æ­¤ Level å°šç„¡å­—åº«");
        return;
    }
    initAll();
};

/* åˆå§‹åŒ– */
function initAll(){
    cardOrder=[...wordList];
    shuffle(cardOrder);
    ci=0;
    loadCard();
    initDict();
}

/* Tab */
tCard.onclick=function(){
 tCard.classList.add("active");
 tDict.classList.remove("active");
 cardSec.style.display="block";
 dictSec.style.display="none";
}
tDict.onclick=function(){
 tDict.classList.add("active");
 tCard.classList.remove("active");
 cardSec.style.display="none";
 dictSec.style.display="block";
 initDict();
 speakDict();
}

initAll();
</script>

</div>
</body>
</html>
